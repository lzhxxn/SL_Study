"use strict";_SL.nmspc("storage").list=function(){var a={formId:"#searchStorageList",storageTreeId:"#storageTree",storageDialogId:"#storage_dlg",storageDialogFormId:"#formStorage",urlSelect:gCONTEXT_PATH+"management/storage_list.json",urlForm:gCONTEXT_PATH+"management/storage_form.html",urlExistId:gCONTEXT_PATH+"management/storage_id_exist.json",urlExistPath:gCONTEXT_PATH+"management/storage_path_exist.json",urlDelete:gCONTEXT_PATH+"management/storage_delete.do",add:{action:gCONTEXT_PATH+"management/storage_insert.do"},update:{action:gCONTEXT_PATH+"management/storage_update.do"}},b={form:$(a.formId),storageTree:$(a.storageTreeId),storageDialog:$(a.storageDialogId),storageDialogForm:$(a.storageDialogId+" #formStorage"),storageId:$(a.storageDialogId+" [name=storage_id]"),storageNm:$(a.storageDialogId+" [name=storage_nm]"),divideYn:$(a.storageDialogId+" [name=divide_yn]"),divideKwKey:$(a.storageDialogId+" [name=divide_keyword_key]"),divideKwVal:$(a.storageDialogId+" [name=divide_keyword_val]"),orgLogBackupYn:$(a.storageDialogId+" [name=org_log_backup_yn]"),useEvtYn:$(a.storageDialogId+" [name=use_event_yn]"),srcPath:$(a.storageDialogId+" [name=src_path]"),indexPath:$(a.storageDialogId+" [name=index_path]"),useDiskManager:$(a.storageDialogId+" [name=use_disk_manager]"),storePath:$(a.storageDialogId+" [name=store_path]"),categoryField:$(a.storageDialogId+" [name=category_field]"),categorys:$(a.storageDialogId+" [name=categorys]"),partitionField:$(a.storageDialogId+" [name=partition_field]"),partitionFormat:$(a.storageDialogId+" [name=partition_format]"),keepDays:$(a.storageDialogId+" [name=keep_days]"),writerCount:$(a.storageDialogId+" [name=writer_count]"),useDataMove:$(a.storageDialogId+" [name=use_data_move]"),movePath:$(a.storageDialogId+" [name=move_path]"),defaultYn:$(a.storageDialogId+" [name=default_yn]"),slKeyId:$(a.storageDialogId+" [name=slKey]"),divideKy:$(a.storageDialogId+" [name=divide_keyword]"),trGrpDivide:$(a.storageDialogId+" .tr-grp-divide"),trDiskManger:$(a.storageDialogId+" .tr-disk-manager"),trCategory:$(a.storageDialogId+" .tr-category"),trPartitionFormat:$(a.storageDialogId+" .tr-partition-format"),trUseDataMove:$(a.storageDialogId+" .tr-use-data-move"),trUseMovePath:$(a.storageDialogId+" .tr-use-move-path"),trKeepDays:$(a.storageDialogId+" .tr-keep-days"),divMylogPartitionField:$(a.storageDialogId+" .div-mylog-partition-field"),divOtherPartitionField:$(a.storageDialogId+" .div-other-partition-field"),viewDefault:$(a.storageDialogId+" .defaultTab"),viewAdvanced:$(a.storageDialogId+" .advancedTab"),viewOtherinfo:$(a.storageDialogId+".otherInformation")},c={isNew:null,mode:null,height:450},d=null,e=function(){g(),h(),j(),l(),m(),n(),b.divideKwKey.chosen({search_contains:!0,width:"100%"}),"-1"==roleId?b.storageDialogForm.find(".otherInformation").css("display","block"):b.storageDialogForm.find(".otherInformation").css("display","none")},f=function(a){switch(b.storageDialogForm.find(".config_tab li").removeClass("tab-item-active"),b.storageDialogForm.find(".config_tab li").eq(a).addClass("tab-item-active"),a){case 0:b.storageDialogForm.find(".defaultTab").css("display","block"),b.storageDialogForm.find(".advancedTab").css("display","none"),k();break;case 1:b.storageDialogForm.find(".defaultTab").css("display","none"),b.storageDialogForm.find(".advancedTab").css("display","block"),k()}},g=function(){b.storageDialogForm.find("[name=category_field],[name=partition_field]").chosen({search_contains:!0,width:"100%"})},h=function(){b.storageDialog.jqxWindow({height:c.height,width:650,autoOpen:!1,maxWidth:650,maxHeight:800,resizable:!1,isModal:!0,modalOpacity:.5,draggable:!0,cancelButton:b.storageDialogForm.find("[data-button-cancel=true]")}),b.storageDialog.on("close",i),b.storageDialog.find(".jqx-window-content").css("overflow","visible")},i=function(){b.storageTree.dynatree("getTree").reload(),f(0),m()},j=function(){b.storageDialogForm.find(".config_tab li").off().on("click",function(){f($(this).index()),slui.attach.setTransformSelect(a.storageDialogFormId)}),b.form.find(".btn-modal-add").on("click",function(){b.storageTree.dynatree("getTree").activateKey("user_storage"),o(!0,null)}),b.storageDialogForm.find(".btn-win-save").on("click",s),b.storageDialogForm.find(".btn-win-delete").on("click",v),b.divideYn.off("change").on("change",function(a){"N"==a.target.value?(b.trGrpDivide.hide(),b.divideKwKey.removeAttr("data-valid"),b.divideKwVal.removeAttr("data-valid")):(b.trGrpDivide.show(),b.divideKwKey.attr("data-valid",_SL.getMessage("FLD.STOR.0016")+",required"),b.divideKwVal.attr("data-valid",_SL.getMessage("FLD.STOR.0016")+",required")),k()}),b.useDiskManager.off("change").on("change",function(a){a.target.value,""==b.categoryField.val()?(b.trCategory.hide(),b.categorys.removeAttr("data-valid")):(b.trCategory.show(),b.categorys.attr("data-valid",_SL.getMessage("FLD.STOR.0008")+",required")),"eqp_dt"==b.partitionField.val()?b.trPartitionFormat.show():b.trPartitionFormat.hide(),k()}),b.categoryField.off("change").on("change",function(a){""==a.target.value?(b.trCategory.hide(),b.categorys.removeAttr("data-valid")):(b.trCategory.show(),b.categorys.attr("data-valid",_SL.getMessage("FLD.STOR.0008")+",required")),k()}),b.partitionField.off("change").on("change",function(a){if("eqp_dt"==a.target.value){b.trPartitionFormat.show();var c=b.partitionFormat.filter(":checked").val();"N"==c||""==c?(b.trUseDataMove.hide(),b.trUseMovePath.hide(),b.trKeepDays.hide(),b.movePath.removeAttr("data-valid")):(b.trUseDataMove.show(),b.trKeepDays.show(),"Y"==b.useDataMove.filter(":checked").val()?(b.trUseMovePath.show(),b.movePath.attr("data-valid",_SL.getMessage("FLD.STOR.0012")+",required")):(b.trUseMovePath.hide(),b.movePath.removeAttr("data-valid")))}else b.trPartitionFormat.hide(),b.trUseDataMove.hide(),b.trUseMovePath.hide(),b.trKeepDays.hide(),b.movePath.removeAttr("data-valid");k()}),b.partitionFormat.off("change").on("change",function(a){"N"==a.target.value||""==a.target.value?(b.trKeepDays.hide(),b.trUseDataMove.hide(),b.trUseMovePath.hide(),b.movePath.removeAttr("data-valid")):(b.trKeepDays.show(),b.trUseDataMove.show(),"Y"==b.useDataMove.filter(":checked").val()?(b.trUseMovePath.show(),b.movePath.attr("data-valid",_SL.getMessage("FLD.STOR.0012")+",required")):(b.trUseMovePath.hide(),b.movePath.removeAttr("data-valid"))),k()}),b.useDataMove.off("change").on("change",function(a){"N"==a.target.value?(b.trUseMovePath.hide(),b.movePath.removeAttr("data-valid")):(b.trUseMovePath.show(),b.movePath.attr("data-valid",_SL.getMessage("FLD.STOR.0012")+",required")),k()})},k=function(){var a=b.storageDialogForm.find("th:visible").size();b.storageDialog.jqxWindow({height:37*a+250})},l=function(){b.storageTree.dynatree({minExpandLevel:3,children:[{title:_SL.getMessage("LBL.STOR.0002"),key:"ALL",isFolder:!0,children:[{title:_SL.getMessage("LBL.STOR.0003"),key:"default_storage",isFolder:!0},{title:_SL.getMessage("LBL.STOR.0004"),key:"user_storage",isFolder:!0}]}],onClick:function(a){if(3==a.getLevel()){var b=a.data.dto;d=b,o(!1,b)}}})},m=function(){var c=function(a){for(var c,d,e,f=b.storageTree.dynatree("getTree"),g=0,h=a.length;g<h;g++)e=a[g],"Y"==e.default_yn?(c=f.getNodeByKey("default_storage"),d={title:"["+e.storage_id+"] "+e.storage_nm,key:e.storage_id,icon:"/resources/imgs/plugins/dynatree/page.gif",dto:e}):(c=f.getNodeByKey("user_storage"),d={title:"["+e.storage_id+"] "+e.storage_nm,key:e.storage_id,dto:e}),c.addChild(d)};$("body").requestData(a.urlSelect,{},{callback:function(a,b,d){c(a)}})},n=function(){slui.attach.tooltip(a.storageDialogFormId)},o=function(d,e){c.isNew=d,q(),c.isNew?(c.mode=a.add,b.storageId.removeClass("form-text").prop("readonly",!1),b.storageDialogForm.find(".btn-win-delete").hide(),p()):(c.mode=a.update,b.storageId.addClass("form-text").prop("readonly",!0),_SL.setDataToForm(e,b.storageDialogForm,{divide_keyword:{converter:function(a,c){if(""!=a){var d=a.split(":");b.divideKwKey.val(d[0]),b.divideKwVal.val(d[1]),b.divideKwKey.trigger("chosen:updated")}}},org_log_backup_yn:{converter:function(a,c){""!=a&&b.orgLogBackupYn.filter("[value="+a+"]").prop("checked",!0)}},use_event_yn:{converter:function(a,c){""!=a&&b.useEvtYn.filter("[value="+a+"]").prop("checked",!0)}},partition_format:{converter:function(a,c){""!=a&&b.partitionFormat.filter("[value="+a+"]").prop("checked",!0)}},use_data_move:{converter:function(a,c){""!=a&&b.useDataMove.filter("[value="+a+"]").prop("checked",!0)}}}),"Y"==e.default_yn?(r(e.storage_id),b.storageDialogForm.find(".btn-win-delete").hide()):b.storageDialogForm.find(".btn-win-delete").show(),p(),"RAW"==e.storage_id&&b.trGrpDivide.filter(":eq(1)").show())},p=function(){b.divideKwKey.trigger("chosen:updated"),b.categoryField.trigger("chosen:updated"),b.partitionField.trigger("chosen:updated"),slui.attach.setTransformSelect(a.storageDialogFormId),b.storageDialog.jqxWindow("open"),b.divideYn.filter(":checked").trigger("change"),b.useDiskManager.filter(":checked").trigger("change"),b.categoryField.trigger("change"),b.partitionField.trigger("change"),b.partitionFormat.filter(":checked").trigger("change"),b.useDataMove.filter(":checked").trigger("change"),b.storageDialog.jqxWindow({position:"center"})},q=function(){b.storageDialogForm.find("input,select").not("[name=storage_id]").prop("disabled",!1),b.storageDialogForm[0].reset(),b.divideKwKey.val(""),b.divOtherPartitionField.show(),b.divMylogPartitionField.hide(),b.categoryField.val(""),b.partitionField.val(""),b.useDiskManager.filter("[value=N]").prop("checked",!0),b.partitionFormat.filter("[value=N]").prop("checked",!0),b.useDataMove.filter("[value=N]").prop("checked",!0),b.writerCount.val("1")},r=function(a){b.storageDialogForm.find("input,select").not("[name=storage_id]").prop("disabled",!0),b.orgLogBackupYn.prop("disabled",!1),"RAW"==a?"-1"==roleId?(b.partitionFormat.prop("disabled",!1),b.categoryField.prop("disabled",!1),b.categorys.prop("disabled",!1),b.keepDays.prop("disabled",!1),b.writerCount.prop("disabled",!1),b.useDataMove.prop("disabled",!1)):(b.useDiskManager.prop("disabled",!1),b.storePath.prop("disabled",!1),b.keepDays.prop("disabled",!1),b.writerCount.prop("disabled",!1),b.useDataMove.prop("disabled",!1),b.movePath.prop("disabled",!1)):("MYLOG"==a&&(b.divMylogPartitionField.show(),b.divOtherPartitionField.hide()),b.keepDays.prop("disabled",!1),b.writerCount.prop("disabled",!1))},s=function(){if(_SL.validate(b.storageDialogForm)&&t()){b.storageDialogForm.find("input,select").not("[name=storage_id]").prop("disabled",!1);var e=!1,f=u();c.isNew||$.each(d,function(a,b){if(e)return!1;$.each(f,function(c,d){if(a==c&&b!=d&&("partition_format"!=a||""!=b&&""!=d)&&"user_id"!=b)return e=!0,!1})}),e&&$.extend(f,{bChange:"Change"}),"Y"==b.defaultYn.val()&&r(b.storageId.val());var g=function(){$("body").requestData(c.mode.action,f,{displayLoader:!0,callback:function(a,c,d){"SUCCESS"==a?_alert(d,{onAgree:function(){b.storageDialog.jqxWindow("close")}}):_alert(_SL.getMessage("ERR.COM.0008"))}})};c.isNew?$("body").requestData(a.urlExistId,{storage_id:b.storageId.val()},{callback:function(a){"OK"==a?g():"EXIST"==a?_alert(_SL.getMessage("WRN.STOR.0001")):_alert(_SL.getMessage("ERR.STOR.0001"))}}):g()}},t=function(){return!!b.storageId.prop("readonly")||(b.storageId.val(b.storageId.val().replace(/ /gi,"")),!!/^[_A-Za-z0-9]*$/gi.test(b.storageId.val())||(_alert(_SL.getMessage("WRN.STOR.0002"),{onAgree:function(){b.storageId.focus()}}),!1))},u=function(){b.storageDialogForm.find("input:text:hidden").not("[name=storage_id], [name=storage_nm], [name=divide_keyword_val], [name=categorys]").val("");var a,c,d,e,f,g=b.partitionField.val();"Y"==b.divideYn.filter(":checked").val()?(a=b.divideKwKey.val()+":"+b.divideKwVal.val(),c=b.orgLogBackupYn.filter(":checked").val(),d=b.useEvtYn.filter(":checked").val()):(a="","RAW"==b.storageId.val()?(c=b.orgLogBackupYn.filter(":checked").val(),d="Y"):"EVENT"==b.storageId.val()||"MYLOG"==b.storageId.val()?(c="Y",d=""):(c="",d="")),""==b.keepDays.val()&&b.keepDays.val(180),"MYLOG"==b.storageId.val()&&(g="user_id"),""!=g&&"user_id"!=g||(e=""),"N"!=b.partitionFormat.filter(":checked").val()&&""!=b.partitionFormat.filter(":checked").val()||(f="");var h=_SL.serializeMap(b.storageDialogForm),i={divide_keyword:a,org_log_backup_yn:c,use_event_yn:d,partition_field:g,partition_format:e,use_data_move:f};return $.extend(h,i)},v=function(){_confirm(_SL.getMessage("CNF.STOR.0001"),{onAgree:function(){$("body").requestData(a.urlDelete,{storage_id:b.storageId.val(),slKey:b.slKeyId.val()},{displayLoader:!0,callback:function(a,c,d){"SUCCESS"==a?_alert(d,{onAgree:function(){b.storageDialog.jqxWindow("close")}}):_alert(_SL.getMessage("ERR.COM.0012"))}})}})};return{init:e}}(),$(function(){slapp.storage.list.init()});