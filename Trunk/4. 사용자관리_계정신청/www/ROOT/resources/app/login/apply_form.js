"use strict";_SL.nmspc("user").form=function(){var a={formId:"#formComuser",urlExist:gCONTEXT_PATH+"interface/comuser_exist.json",urlFileUpload:gCONTEXT_PATH+"system/comuser_file_upload.do",urlPasswdExist:gCONTEXT_PATH+"main/comuser_passwd_inform.json",add:{action:gCONTEXT_PATH+"interface/apply_insert.do",message:_SL.getMessage("CNF.COM.0006"),passwdValid:_SL.getMessage("FLD.COM.0152")+",required,password"}},b={form:$(a.formId),userId:$(a.formId+" [name=user_id]"),userNm:$(a.formId+" [name=user_nm]"),telNo:$(a.formId+" [name=tel_no]"),mobileNo:$(a.formId+" [name=mobile_no]"),lineTo:$(a.formId+" [name=line_token]"),applyStatus:$(a.formId+" [name=apply_status]"),slKeyId:$(a.formId+" [name=slKey]")},c={password:function(c){if(""!=$(c).val()){var d=(void 0===b.form.find("[name=user_id]").val()?b.form.find("[name='p_user_id']").val():b.form.find("[name=user_id]").val(),$(c).val()),e=this,f=0,g=0,h=!1,i=b.telNo.val(),j=b.mobileNo.val(),k=i.split("-"),l=j.split("-"),m=!1;$("body").requestData(a.urlPasswdExist,_SL.serializeMap(b.form),{async:!1,callback:function(b,c,n){if(!1===b.isDup&&mState.mode==a.add)e.message=_SL.getMessage("WRN.USR.0009"),e.bValid=!1;else if(!1===b.isDup)e.message=_SL.getMessage("WRN.USR.0021"),e.bValid=!1;else{var o=b.passwdInform.upper_case_yn,p=b.passwdInform.lower_case_yn,q=b.passwdInform.number_yn,r=b.passwdInform.special_character_yn,s=b.passwdInform.length,t=b.passwdInform.continum_yn,u=b.passwdInform.contichar_yn;if(/[가-힣]/.test(d))return e.message=_SL.getMessage("WRN.USR.0022"),void(e.bValid=!1);if("Y"===o&&!/[A-Z]/.test(d))return e.message=_SL.getMessage("WRN.USR.0023"),void(e.bValid=!1);if("Y"===p&&!/[a-z]/.test(d))return e.message=_SL.getMessage("WRN.USR.0024"),void(e.bValid=!1);if("Y"===q&&!/[\d]/.test(d))return e.message=_SL.getMessage("WRN.USR.0025"),void(e.bValid=!1);if("Y"===r&&!/[^A-Za-z0-9]/.test(d))return e.message=_SL.getMessage("WRN.USR.0026"),void(e.bValid=!1);if(0!=s&&d.length<s)return e.message=_SL.getMessage("WRN.USR.0019")+s+_SL.getMessage("WRN.USR.0020"),void(e.bValid=!1);for(var v=0;v<d.length;v++){var w=0,x=0;if(v>=1){if(isNaN(d.charAt(v-1))||isNaN(d.charAt(v)))continue;isNaN(d.charAt(v-1))||(w=d.charCodeAt(v-1)),isNaN(d.charAt(v))||(x=d.charCodeAt(v)),w-x==-1&&f++,w==x&&f++}}for(var v=0;v<d.length;v++){var w=0,x=0;if(v>=1){if(!isNaN(d.charAt(v-1))||!isNaN(d.charAt(v)))continue;isNaN(d.charAt(v-1))&&(w=d.charCodeAt(v-1)),isNaN(d.charAt(v))&&(x=d.charCodeAt(v)),w-x==-1&&g++,w==x&&g++}}if((0==f&&i||0==g&&i)&&(k.length>1?$.each(k,function(a,b){if(d.indexOf(b)>-1)return h=!0,!1}):d.indexOf(i)>-1&&(h=!0),!h&&j&&(l.length>1?$.each(l,function(a,b){if(d.indexOf(b)>-1)return m=!0,!1}):d.indexOf(j)>-1&&(m=!0))),0!=t&&f>=t)return e.message=_SL.getMessage("WRN.USR.0027")+t+_SL.getMessage("WRN.USR.0029"),void(e.bValid=!1);if(0!=u&&g>=u)return e.message=_SL.getMessage("WRN.USR.0028")+u+_SL.getMessage("WRN.USR.0029"),void(e.bValid=!1);if(h)return e.message=_SL.getMessage("WRN.USR.0030"),void(e.bValid=!1);if(m)return e.message=_SL.getMessage("WRN.USR.0031"),void(e.bValid=!1)}}})}}},d=function(){b.form.find(".btn-add").on("click",e),b.form.find("#cust_add").click(function(){var a=b.form.find("[name=user_cust_list] option:selected").val(),c=b.form.find("[name=user_cust_list] option:selected").text();return""==a?void _alert(_SL.getMessage("WRN.COM.0038")):b.form.find("[name=cust_list] option").is(function(){return this.value==a})?void _alert(_SL.getMessage("WRN.COM.0039")):void b.form.find("[name=cust_list]").append($("<option>").val(a).text(c))}),b.form.find("#cust_del").click(function(){b.form.find("[name=cust_list] :selected").remove()}),"Y"!=gUserIpRestrictYn&&b.form.find("[name=auth_ip_opt]").click(function(){$(this).val();"0"==$(this).val()?b.form.find("[data-name=auth_ip_wrapper]").hide():b.form.find("[data-name=auth_ip_wrapper]").show()}),b.form.find("#fileUpload").click(function(){b.form.find("[name=file_upload]").click()}),b.form.find("[name=file_upload]").on("change",f)},e=function(){var c=($(this).data("after-close"),b.form.find("[name=passwd]").val()),d=b.form.find("[name=passwd2]").val();if(c!=d)return""!=d&&""==c?(_alert(_SL.getMessage("WRN.USR.0005")),void b.form.find("[name=passwd]").focus()):""!=c&&""==d?(_alert(_SL.getMessage("WRN.USR.0006")),void b.form.find("[name=passwd2]").focus()):(_alert(_SL.getMessage("WRN.USR.0007")),void b.form.find("[name=passwd2]").val("").focus());if(b.form.find("[name=auth_ip_opt][value=0]").is(":checked")&&(b.form.find("[name=auth_ip1]").val(""),b.form.find("[name=auth_ip2]").val("")),_SL.validate(b.form)){if(!b.form.find("[name=auth_ip_opt][value=0]").is(":checked")){var e=b.form.find("[name=auth_ip1]").val(),f=b.form.find("[name=auth_ip2]").val();if(!e&&!f)return _alert(_SL.getMessage("WRN.USR.0008")),void b.form.find("[name=auth_ip1]").focus();if("255.255.255.255"==e||"255.255.255.255"==f)return _alert(_SL.getMessage("WRN.USR.0012")),void("255.255.255.255"==e?b.form.find("[name=auth_ip1]").focus():b.form.find("[name=auth_ip2]").focus())}var i=function(){$("body").requestData(a.add.action,_SL.serializeMap(b.form),{displayLoader:!0,callback:function(a,b,c){g(),_alert("신청되었습니다.",{onAgree:function(){h(!0)}})}})};$("body").requestData(a.urlExist,{user_id:b.userId.val()},{callback:function(a){1==a?i():_alert(_SL.getMessage("WRN.USR.0009"))}})}},f=function(a){var c=a.target.files[0],d=(c.name.length,b.form.find("[name=file_upload]"));if(c.name.length>100)return _alert("파일명이 너무 깁니다!"),d.val(""),!1;if(!c.type.match("image.*"))return _alert("이미지만 가능합니다!"),d.val(""),!1;if(c.size>1048576)return _alert("이미지는 1MB까지 업로드가 가능합니다."),$input_file.val(""),!1;var e=new FileReader;e.readAsDataURL(c),e.onload=function(){$("#fileUpload").empty(),$("#fileUpload").css("border","0px"),$("#fileUpload").append('<img name="user_img" src="'+e.result+'" style="width: 140px; height: 165px; padding: 5px 0 0 5px;">')}},g=function(){b.form.attr({enctype:"multipart/form-data",method:"post",action:a.urlFileUpload}),b.form.ajaxSubmit()},h=function(a){a&&b.form.find("[data-layer-close=true]").click()};return{init:function(){d(),b.form.find("[name=passwd]").attr("data-valid",a.add.passwdValid),"Y"!=gUserIpRestrictYn&&(""==b.form.find("[name=auth_ip1]").val()&&""==b.form.find("[name=auth_ip2]").val()?b.form.find("[name=auth_ip_opt][value=0]").trigger("click"):b.form.find("[name=auth_ip_opt][value=1]").trigger("click")),$.extend(!0,_SL.validate.Validator,c),b.form.find(".form-input").keypress(function(a){13==a.keyCode&&onConfrim()}),b.form.find("[name=group_cd]").chosen({search_contains:!0,width:"100%"}),b.form.find("[name=user_cust_list]").chosen({search_contains:!0,width:"100%"})}}}(),$(function(){slapp.user.form.init()});