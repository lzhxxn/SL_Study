"use strict";_SL.nmspc("user").form=function(){var a={formId:"#formComuser",urlSelect:gCONTEXT_PATH+"system/user_apply.json",urlExist:gCONTEXT_PATH+"system/user_apply_exist.json",urlPasswdExist:gCONTEXT_PATH+"main/comuser_passwd_inform.json",reject:gCONTEXT_PATH+"system/user_apply_reject.do",confirm:{action:gCONTEXT_PATH+"system/user_apply_confirm.do",message:_SL.getMessage("CNF.COM.0002"),passwdValid:_SL.getMessage("FLD.COM.0152")+",password"}},b={form:$(a.formId),userId:$(a.formId+" [name=user_id]"),userNm:$(a.formId+" [name=user_nm]"),telNo:$(a.formId+" [name=tel_no]"),mobileNo:$(a.formId+" [name=mobile_no]"),lineTo:$(a.formId+" [name=line_token]"),applyStatus:$(a.formId+" [name=apply_status]"),slKeyId:$(a.formId+" [name=slKey]")},c={isNew:""==b.userId.val()},d={password:function(d){if(""!=$(d).val()){var e=(void 0===b.form.find("[name=user_id]").val()?b.form.find("[name='p_user_id']").val():b.form.find("[name=user_id]").val(),$(d).val()),f=this,g=0,h=0,i=!1,j=b.telNo.val(),k=b.mobileNo.val(),l=j.split("-"),m=k.split("-"),n=!1;$("body").requestData(a.urlPasswdExist,_SL.serializeMap(b.form),{async:!1,callback:function(b,d,o){if(!1===b.isDup&&c.mode==a.add)f.message=_SL.getMessage("WRN.USR.0009"),f.bValid=!1;else if(!1===b.isDup)f.message=_SL.getMessage("WRN.USR.0021"),f.bValid=!1;else{var p=b.passwdInform.upper_case_yn,q=b.passwdInform.lower_case_yn,r=b.passwdInform.number_yn,s=b.passwdInform.special_character_yn,t=b.passwdInform.length,u=b.passwdInform.continum_yn,v=b.passwdInform.contichar_yn;if(/[가-힣]/.test(e))return f.message=_SL.getMessage("WRN.USR.0022"),void(f.bValid=!1);if("Y"===p&&!/[A-Z]/.test(e))return f.message=_SL.getMessage("WRN.USR.0023"),void(f.bValid=!1);if("Y"===q&&!/[a-z]/.test(e))return f.message=_SL.getMessage("WRN.USR.0024"),void(f.bValid=!1);if("Y"===r&&!/[\d]/.test(e))return f.message=_SL.getMessage("WRN.USR.0025"),void(f.bValid=!1);if("Y"===s&&!/[^A-Za-z0-9]/.test(e))return f.message=_SL.getMessage("WRN.USR.0026"),void(f.bValid=!1);if(0!=t&&e.length<t)return f.message=_SL.getMessage("WRN.USR.0019")+t+_SL.getMessage("WRN.USR.0020"),void(f.bValid=!1);for(var w=0;w<e.length;w++){var x=0,y=0;if(w>=1){if(isNaN(e.charAt(w-1))||isNaN(e.charAt(w)))continue;isNaN(e.charAt(w-1))||(x=e.charCodeAt(w-1)),isNaN(e.charAt(w))||(y=e.charCodeAt(w)),x-y==-1&&g++,x==y&&g++}}for(var w=0;w<e.length;w++){var x=0,y=0;if(w>=1){if(!isNaN(e.charAt(w-1))||!isNaN(e.charAt(w)))continue;isNaN(e.charAt(w-1))&&(x=e.charCodeAt(w-1)),isNaN(e.charAt(w))&&(y=e.charCodeAt(w)),x-y==-1&&h++,x==y&&h++}}if((0==g&&j||0==h&&j)&&(l.length>1?$.each(l,function(a,b){if(e.indexOf(b)>-1)return i=!0,!1}):e.indexOf(j)>-1&&(i=!0),!i&&k&&(m.length>1?$.each(m,function(a,b){if(e.indexOf(b)>-1)return n=!0,!1}):e.indexOf(k)>-1&&(n=!0))),0!=u&&g>=u)return f.message=_SL.getMessage("WRN.USR.0027")+u+_SL.getMessage("WRN.USR.0029"),void(f.bValid=!1);if(0!=v&&h>=v)return f.message=_SL.getMessage("WRN.USR.0028")+v+_SL.getMessage("WRN.USR.0029"),void(f.bValid=!1);if(i)return f.message=_SL.getMessage("WRN.USR.0030"),void(f.bValid=!1);if(n)return f.message=_SL.getMessage("WRN.USR.0031"),void(f.bValid=!1)}}})}}},e=function(){f(),b.form.find("[name=passwd]").attr("data-valid",a.confirm.passwdValid),"Y"!=gUserIpRestrictYn&&(""==b.form.find("[name=auth_ip1]").val()&&""==b.form.find("[name=auth_ip2]").val()?b.form.find("[name=auth_ip_opt][value=0]").trigger("click"):b.form.find("[name=auth_ip_opt][value=1]").trigger("click")),$.extend(!0,_SL.validate.Validator,d),c.isNew||g(),b.form.find(".form-input").keypress(function(a){13==a.keyCode&&onConfrim()}),b.form.find("[name=group_cd]").chosen({search_contains:!0,width:"100%"}),b.form.find("[name=user_cust_list]").chosen({search_contains:!0,width:"100%"})},f=function(){b.form.find(".btn-confirm").on("click",h),b.form.find(".btn-reject").on("click",i),b.form.find("#cust_add").click(function(){var a=b.form.find("[name=user_cust_list] option:selected").val(),c=b.form.find("[name=user_cust_list] option:selected").text();return""==a?void _alert(_SL.getMessage("WRN.COM.0038")):b.form.find("[name=cust_list] option").is(function(){return this.value==a})?void _alert(_SL.getMessage("WRN.COM.0039")):void b.form.find("[name=cust_list]").append($("<option>").val(a).text(c))}),b.form.find("#cust_del").click(function(){b.form.find("[name=cust_list] :selected").remove()}),"Y"!=gUserIpRestrictYn&&b.form.find("[name=auth_ip_opt]").click(function(){$(this).val();"0"==$(this).val()?b.form.find("[data-name=auth_ip_wrapper]").hide():b.form.find("[data-name=auth_ip_wrapper]").show()}),b.form.find("#fileUpload").click(function(){b.form.find("[name=file_upload]").click()}),b.form.find("[name=file_upload]").on("change",j)},g=function(){var c=b.userId.val(),d={user_id:c},e=function(c){if(c.passwd="",c.auth_ip&&""!=c.auth_ip)for(var d=c.auth_ip.split(","),e=0,f=d.length;e<f;e++)c["auth_ip"+(e+1)]=d[e];$("#fileUpload").css("border","0px"),""!=c.user_img&&void 0!=c.user_img?$("#fileUpload").append('<img name="user_img" src="'+c.user_img+'" style="width: 140px; height: 165px; padding: 5px 0 0 5px;">'):$("#fileUpload").append('<img name="user_img" src="\\resources\\imgs\\threat\\blackboard\\default_user_icon.png" style="width: 140px; height: 165px; padding: 5px 0 0 5px;">'),$(".user-imgupload-text").remove(),_SL.setDataToForm(c,b.form,{cust_list:{converter:function(a,b){_SL.appendToSelect(a,b,"cust_id","cust_nm")}},auth_ip:{field:"auth_ip1",converter:function(a,c){""!=a&&b.form.find("[name=auth_ip_opt][value=1]").trigger("click")}},group_cd:{converter:function(a,c){b.form.find("[name=group_cd]").val(a),b.form.find("[name=group_cd]").trigger("chosen:updated")}}}),slui.attach.setTransformSelect(a.formId)};$("body").requestData(a.urlSelect,d,{callback:e})},h=function(){$(this).data("after-close");$("body").requestData(a.confirm.action,_SL.serializeMap(b.form),{displayLoader:!0,callback:function(a,b,c){k(),_alert("계정신청서를 승인했습니다.",{onAgree:function(){l(!0),location.reload()}})}})},i=function(){$(this).data("after-close");$("body").requestData(a.reject,_SL.serializeMap(b.form),{displayLoader:!0,callback:function(a,b,c){k(),_alert("계정신청서를 거절했습니다.",{onAgree:function(){l(!0),location.reload()}})}})},j=function(a){var c=a.target.files[0],d=(c.name.length,b.form.find("[name=file_upload]"));if(c.name.length>100)return _alert("파일명이 너무 깁니다!"),d.val(""),!1;if(!c.type.match("image.*"))return _alert("이미지만 가능합니다!"),d.val(""),!1;if(c.size>1048576)return _alert("이미지는 1MB까지 업로드가 가능합니다."),$input_file.val(""),!1;var e=new FileReader;e.readAsDataURL(c),e.onload=function(){$("#fileUpload").empty(),$("#fileUpload").css("border","0px"),$("#fileUpload").append('<img name="user_img" src="'+e.result+'" style="width: 140px; height: 165px; padding: 5px 0 0 5px;">')}},k=function(){b.form.attr({enctype:"multipart/form-data",method:"post",action:a.urlFileUpload}),b.form.ajaxSubmit()},l=function(a){a&&b.form.find("[data-layer-close=true]").click()};return{init:e}}(),$(function(){slapp.user.form.init()});