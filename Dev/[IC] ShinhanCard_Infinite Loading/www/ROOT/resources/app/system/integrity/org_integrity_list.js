"use strict";_SL.nmspc("orgintegrity").list=function(){var a={urlList:gCONTEXT_PATH+"system/org_integrity_list.json",urlChkIntegrity:gCONTEXT_PATH+"system/org_integrity_check.json",urlUpdateIntegrity:gCONTEXT_PATH+"system/org_integrity_update.do",urlDownload:gCONTEXT_PATH+"system/org_integrity_export_csv.do",urlDownloadExcel:gCONTEXT_PATH+"system/org_integrity_export_excel.do",urlGetAllSize:gCONTEXT_PATH+"system/org_integrity_all_fsize.json",formId:"#searchOrgIntegrityList",tagFormId:"#OrgStatsForm",multiSrhId:"#multiSearchOrgIntegrity",gridId:"#gridOrgIntegrityList",dialogId:"#view_detail",btnDownloadPlus:"#orgDownloadDiv .btn-download-plus",selDownload:"#download",btnDownload:"btn-download",btnCancel:"btn-cancel",downloadStatsFunc:"[name=download_stats_func]"},b={form:$(a.formId),tagform:$(a.tagFormId),grid:$(a.gridId),dialog:$(a.dialogId),selDownload:$(a.selDownload),btnDownload:$(a.btnDownload),downloadStatsFunc:$(a.downloadStatsFunc),slKeyId:$(a.formId+" [name=slKey]")},c=new slui.cookies,d=function(){c.init(a.gridId);var d=b.grid.parent().siblings(".grid-bottom").find(".btn-update");f(b.grid),g(),d.off().on("click",function(){var a=[],c=[],d=$.map(b.grid.find("[name=chk_idx]"),function(a){if(a.checked)return a.value}),e=b.grid.jqxGrid("getdisplayrows"),f="";for(var g in e)for(var h=0,i=d.length;h<i;h++)d[h]==e[g].boundindex&&c.push(e[g].boundindex);if(c.length>0){for(var h=0,j=c.length;h<j;h++){var k=b.grid.jqxGrid("getrowdata",c[h]);""===k.cur_md5&&(f+="["+_SL.getMessage("LBL.INTGR.0003")+" : "+k.src_path_name+"] ["+_SL.getMessage("FLD.COM.0074")+" : "+k.file_name+"]<br/>"),a.push(k.integrity_id)}if(""!=f)return f+=_SL.getMessage("WRN.INTGR.0001"),void _alert(f);l(a)}else _alert(_SL.getMessage("WRN.INTGR.0002"))}),b.dialog.jqxWindow({height:100,width:500,autoOpen:!1,resizable:!1,isModal:!0,modalOpacity:.5}),$(a.btnDownloadPlus).on("click",o),e()},e=function(){$("body").requestData(a.urlGetAllSize,_SL.serializeMap(b.form),{callback:function(a,c,d){b.tagform.find(".orgFileSize").text("원본파일크기: "+h(a.agentFSize)),b.tagform.find(".agentFileSize").text("원본ZIP: "+h(a.orgFSize)),b.tagform.find(".crshFileSize").text("압축률: "+a.crshSize+"%")}})},f=function(d){var e={datatype:"json",datafields:[{name:"recv_time",type:"string"},{name:"t_recv_time",type:"string"},{name:"eqp_ip",type:"string"},{name:"data_type",type:"string"},{name:"data_type_nm",type:"string"},{name:"src_path_name",type:"string"},{name:"file_path",type:"string"},{name:"file_name",type:"string"},{name:"agent_file_size",type:"string"},{name:"org_file_size",type:"string"},{name:"org_md5",type:"string"},{name:"org_md5_dt",type:"string"},{name:"cur_file_size",type:"string"},{name:"cur_md5",type:"string"},{name:"cur_md5_dt",type:"string"},{name:"change_opt",type:"string"},{name:"chg_yn",type:"string"},{name:"file_press",type:"string"},{name:"enc_type",type:"string"},{name:"enc_key",type:"string"}],root:"rows",beforeprocessing:function(a){null!=a&&(e.totalrecords=a.totalRows)},cache:!1,url:a.urlList},f=new $.jqx.dataAdapter(e,{beforeLoadComplete:function(a){for(var b in a)a[b].t_recv_time=_SL.formatLcDate(a[b].recv_time,"yyyyMMddHHmm",_SL.formatDate.getLcPattern("ymdhm"));return a},formatData:function(b){var c,d={},e=$(a.formId).serializeArray();for(c in e)d[e[c].name]=e[c].value;return $.extend(b,d),b},loadComplete:function(){b.grid.find(".iconscontainer").remove(),b.grid.find("#jqxScrollWraphorizontalScrollBargridOrgIntegrityList").hide(),k()},loadError:function(a,b,c){alert(c)}});d.jqxGrid({keyboardnavigation:!1,enablebrowserselection:!0,source:f,width:"100%",pagesize:c.getValue(),selectionmode:"none",virtualmode:!0,rendergridrows:function(a){return a.data},columns:[{text:"No",columntype:"number",width:40,cellsalign:"center",cellsrenderer:function(a,b,c,d){return $(d).text(c+1)[0].outerHTML}},{text:_SL.getMessage("LBL.COM.0052"),datafield:"t_recv_time",width:"10%",cellsalign:"center"},{text:_SL.getMessage("FLD.COM.0161"),datafield:"eqp_ip",width:"6%",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){return $(d).html('<label data-ui="tooltip" data-text="'+c+'">'+c+"</label>")[0].outerHTML}},{text:_SL.getMessage("FLD.COM.0222"),datafield:"data_type_nm",width:"5%",cellsalign:"center"},{text:_SL.getMessage("FLD.COM.0223"),datafield:"src_path_name",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){return $(d).html('<label data-ui="tooltip" data-text="'+c+'">'+c+"</label>")[0].outerHTML}},{text:_SL.getMessage("FLD.COM.0074"),datafield:"file_name",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){var g=f.file_path;return $(d).html('<label data-ui="tooltip" data-text="'+g+"/"+c+'">'+c+"</label>")[0].outerHTML}},{text:"원본파일크기",datafield:"agent_file_size",cellsalign:"center",width:"6%",cellsrenderer:function(a,b,c,d,e,f){var g=f.agent_file_size;return $(d).html("<div>"+h(g)+"</div>")[0].outerHTML}},{text:"원본ZIP",datafield:"org_file_size",cellsalign:"center",width:"6%",cellsrenderer:function(a,b,c,d,e,f){var g=f.org_file_size;return $(d).html("<div>"+h(g)+"</div>")[0].outerHTML}},{text:_SL.getMessage("FLD.COM.0227")+"(%)",datafield:"file_press",width:"5%",cellsalign:"center",cellsrenderer:function(a,b,c,d,e,f){var g=Number(c);return 0!=c&&(g=g.toFixed(1)),$(d).html('<div data-ui="tooltip" data-text="원본ZIP/원본파일크기">'+g+"%</div>")[0].outerHTML}},{text:"현재ZIP",datafield:"cur_file_size",cellsalign:"center",width:"6%",cellsrenderer:function(a,b,c,d,e,f){var g=f.cur_file_size;return null==g?$(d).html("<div></div>")[0].outerHTML:$(d).html("<div>"+h(g)+"</div>")[0].outerHTML}},{text:_SL.getMessage("FLD.COM.0026"),datafield:"chg_yn",cellsalign:"center",width:"5%",cellsrenderer:function(a,b,c,d,e,f){return"Y"==c?$(d).html('&nbsp;<span style="cursor:pointer;" class="label-danger text-danger">'+_SL.getMessage("LBL.COM.0091")+"</span>")[0].outerHTML:"N"==c?$(d).html('&nbsp;<span style="cursor:pointer;" class="label-success">'+_SL.getMessage("LBL.COM.0079")+"</span>")[0].outerHTML:void 0}},{text:_SL.getMessage("FLD.COM.0229"),datafield:"enc_type",width:"6%",cellsalign:"center"},{text:_SL.getMessage("FLD.INTGR.0003"),datafield:"Edit",columntype:"button",width:90,cellsrenderer:function(a,b,c,d,e,f){return _SL.getMessage("FLD.INTGR.0004")},buttonclick:function(a){var b=d.jqxGrid("getrowdata",a);m(b.recv_time,b.eqp_ip,b.src_path_name,b.file_path,b.file_name)}}]}),d.on("cellclick",function(b){if("agent_nm"===b.args.datafield){var c=b.args.row.bounddata.agent_id;viewDetail(a.urlForm+"?agent_id="+c)}if("inspection"===b.args.datafield&&viewAgentControl(b.args.row.bounddata.agent_ip),"chg_yn"===b.args.datafield){var d=b.args.row.bounddata;d.org_md5.length>0&&i(d.org_md5,d.cur_md5)}}),c.changeEvent(),k()},g=function(){b.form.find(".form-submit").off().on("click",function(){_SL.validate(b.form)&&(b.grid.jqxGrid("gotopage",0),j(),e())}),b.form.find(".form-input").keypress(function(a){if(13==a.keyCode){if(!_SL.validate(b.form))return;b.grid.jqxGrid("gotopage",0),j()}}),b.selDownload.jqxWindow({width:400,height:140,autoOpen:!1,resizable:!1,isModal:!0,modalOpacity:.5,cancelButton:b.selDownload.find("."+a.btnCancel),initContent:function(){slui.attach.setTransformSelect(a.selDownload)}}),b.form.find(".btn-submit").off().on("click",function(){var a=_SL.formatLcDate(b.sDay.val()+b.sHour.val()+b.sMin.val(),"ymdhmSTD","yyyyMMddHHmm"),c=_SL.formatLcDate(b.eDay.val()+b.eHour.val()+b.eMin.val(),"ymdhmSTD","yyyyMMddHHmm"),d=b.form.find("[name=eqp_ip]").val();return a>c?void _alert(_SL.getMessage("WRN.COM.0003")):""==d?void _alert(_SL.getMessage("WRN.COM.0026")):void j()}),b.form.find("[name=timeSet]").change(function(){var a=this.value;if(0!=a){var c=function(a,b){a.siblings(".tform-select").find(".tform-select-t").text(b).end().find(".tform-select-option[data-value="+b+"]").addClass("selected").end(),a.val(b)},d=b.form.find("[name=endDay]").val()+b.form.find("[name=endHour]").val()+b.form.find("[name=endMin]").val(),e=_SL.formatDate.addMin(d,-a,_SL.formatDate.getLcPattern("ymdhmSTD"));c(b.form.find("[name=startDay]"),e.substring(0,8)),c(b.form.find("[name=startHour]"),e.substring(8,10)),c(b.form.find("[name=startMin]"),e.substring(10,12))}}),b.form.find("[name=startDay],[name=startHour],[name=startMin],[name=endDay],[name=endHour],[name=endMin]").change(function(){var a=b.form.find("[name=timeSet]"),c=a.siblings(".tform-select").find("[data-value=0]").text();a.val(0).siblings(".tform-select").find(".tform-select-t").text(c)})},h=function(a){var b=["Bytes","KB","MB","GB","TB"];if(0==a)return"0 Bytes";var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return 0==c?a+" "+b[c]:(a/Math.pow(1024,c)).toFixed(1)+" "+b[c]},i=function(a,c){b.dialog.find("#view_text_org").text(_SL.getMessage("FLD.INTGR.0001")+" :"+a),b.dialog.find("#view_text_cur").text(_SL.getMessage("FLD.INTGR.0002")+" :"+c),b.dialog.jqxWindow({position:"center"}),b.dialog.jqxWindow("open")},j=function(){b.grid.jqxGrid("updatebounddata"),b.grid.jqxGrid("clearselection"),k()},k=function(){setTimeout(function(){slui.attach.tooltip("body")},500)},l=function(c){$("body").requestData(a.urlUpdateIntegrity,{id_list:c,slKey:b.slKeyId.val()},{callback:function(a,b,c){_alert(c,{onAgree:function(){j()}})}})},m=function(b,c,d,e,f){var g=b,h=c,i=d,k=e,l=f,m=f;-1!=m.indexOf(".jar")&&(m="../"+m),$("body").requestData(a.urlChkIntegrity,{recvTime:g,eqpIp:h,srcPathName:i,filePath:k,oFileName:l,nFileName:m},{callback:function(a,b,c){_alert(a.message,{onAgree:function(){j()}})}})},n=function(){"csv"==b.downloadStatsFunc.val()?b.form.attr({action:a.urlDownload}).submit():b.form.attr({action:a.urlDownloadExcel}).submit(),p()},o=function(){b.selDownload.jqxWindow("open"),b.selDownload.off().on("click","."+a.btnDownload,n)},p=function(){b.selDownload.jqxWindow("close")};return{init:d}}(),$(function(){slapp.orgintegrity.list.init()});